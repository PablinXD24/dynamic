<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Island Spotify</title>
    <style>
        body { background: #000; color: white; display: flex; justify-content: center; padding-top: 50px; font-family: sans-serif; }
        .btn { background: #1DB954; color: black; padding: 15px 30px; border-radius: 50px; text-decoration: none; font-weight: bold; cursor: pointer; }
        .btn:hover { background: #1ed760; }
    </style>
</head>
<body>

    <a id="loginLink" href="#" class="btn">CONECTAR SPOTIFY</a>

    <script>
        // CONFIGURAÇÃO
        const CLIENT_ID = 'ff2d9d81535645d29d8ba470833a264d'; 
        
        // Importante: Esta URL deve ser IDÊNTICA à cadastrada no Spotify Dashboard
        // E deve começar com https:// para funcionar corretamente na maioria dos navegadores modernos
        const REDIRECT_URI = 'https://pablinxd24.github.io/dynamic/'; 
        
        // --- CORREÇÃO FEITA AQUI ---
        // Endpoint oficial do Spotify Accounts
        const AUTH_ENDPOINT = 'https://accounts.spotify.com/authorize';
        
        const SCOPES = [
            'user-read-playback-state',
            'user-modify-playback-state',
            'user-read-currently-playing',
            'user-read-email',
            'user-read-private',
            'streaming'
        ];

        // O 'join' converte o array acima em uma string separada por espaços
        const SPACE_DELIMITER = '%20';
        const SCOPES_URL_PARAM = SCOPES.join(SPACE_DELIMITER);

        /* Nota: O fluxo "token" (Implicit Grant) é funcional, mas o Spotify recomenda PKCE para produção.
           Para testes simples, isso funcionará se o Redirect URI estiver correto.
        */
        const authUrl = `${AUTH_ENDPOINT}?client_id=${CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&scope=${SCOPES_URL_PARAM}&response_type=token&show_dialog=true`;
        
        document.getElementById('loginLink').href = authUrl;

        // Lógica simples para pegar o token da URL após o redirecionamento
        const getReturnedParamsFromSpotifyAuth = (hash) => {
            const stringAfterHashtag = hash.substring(1);
            const paramsInUrl = stringAfterHashtag.split('&');
            const paramsSplitUp = paramsInUrl.reduce((accumulater, currentValue) => {
                const [key, value] = currentValue.split('=');
                accumulater[key] = value;
                return accumulater;
            }, {});
            return paramsSplitUp;
        }

        if(window.location.hash) {
            const params = getReturnedParamsFromSpotifyAuth(window.location.hash);
            if(params.access_token) {
                // Oculta o botão e mostra sucesso
                document.getElementById('loginLink').style.display = 'none';
                document.body.innerHTML += '<h1 style="color:#1DB954">SUCESSO! CONECTADO.</h1>';
                
                // Para testar, imprime o token no console
                console.log("Token:", params.access_token);
                
                // AQUI VOCÊ INICIARIA O CÓDIGO DA DYNAMIC ISLAND
            }
        }
    </script>

</body>
</html>
